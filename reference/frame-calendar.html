<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Rearrange a temporal data frame to a calendar-based data format using linear algebra — frame_calendar • sugrrants</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Rearrange a temporal data frame to a calendar-based data format using linear algebra — frame_calendar" />
<meta property="og:description" content="Temporal data of daily intervals or higher frequency levels can be organised
into a calendar-based format, which is useful for visually presenting
calendar-related activities or multiple seasonality (such as time of day,
day of week, day of month). The function only returns a rearranged data frame,
and ggplot2 takes care of the plotting afterwards. It allows more
flexibility for users to visualise the data in various ways." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sugrrants</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/frame-calendar.html">Calendar based graphics</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/earowang/sugrrants">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Rearrange a temporal data frame to a calendar-based data format using linear algebra</h1>
    
    <div class="hidden name"><code>frame-calendar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Temporal data of daily intervals or higher frequency levels can be organised
into a calendar-based format, which is useful for visually presenting
calendar-related activities or multiple seasonality (such as time of day,
day of week, day of month). The function only returns a rearranged data frame,
and <code>ggplot2</code> takes care of the plotting afterwards. It allows more
flexibility for users to visualise the data in various ways.</p>
    </div>

    <pre class="usage"><span class='fu'>frame_calendar</span>(
  <span class='no'>data</span>,
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='no'>date</span>,
  <span class='kw'>calendar</span> <span class='kw'>=</span> <span class='st'>"monthly"</span>,
  <span class='kw'>dir</span> <span class='kw'>=</span> <span class='st'>"h"</span>,
  <span class='kw'>week_start</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"lubridate.week.start"</span>, <span class='fl'>1</span>),
  <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>polar</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='st'>"fixed"</span>,
  <span class='kw'>width</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='kw'>height</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='kw'>margin</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>prettify</span>(<span class='no'>plot</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"label"</span>, <span class='st'>"text"</span>), <span class='no'>locale</span>, <span class='kw'>abbr</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame or a grouped data frame including a <code>Date</code> variable.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A bare (or unquoted) variable mapping to x axis, for example time of
day. If integer 1 is specified, it simply returns calendar grids on x
without transformation.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>A bare (or unquoted) variable or more mapping to y axis. More than
one variable need putting to <code><a href='https://dplyr.tidyverse.org/reference/vars.html'>vars()</a></code>. If integer 1 is specified, it returns
calendar grids on y without transformation.</p></td>
    </tr>
    <tr>
      <th>date</th>
      <td><p>A <code>Date</code> variable mapping to dates in the calendar.</p></td>
    </tr>
    <tr>
      <th>calendar</th>
      <td><p>Type of calendar. (1) "monthly" calendar (the default) organises
the <code>data</code> to a common format comprised of day of week in the column and
week of month in the row. A monthly calendar is set up as a 5 by 7 layout
matrix. Each month could extend over six weeks but in these months is to
wrap the last few days up to the top row of the block. (2) "weekly"
calendar consists of day of week and week of year. (3) "daily" calendar
refers to day of month and month of year.</p></td>
    </tr>
    <tr>
      <th>dir</th>
      <td><p>Direction of calendar: "h" for horizontal (the default) or "v" for
vertical.</p></td>
    </tr>
    <tr>
      <th>week_start</th>
      <td><p>Day on which week starts following ISO conventions -
1 means Monday (default), 7 means Sunday. You can set <code>lubridate.week.start</code>
option to control this parameter globally.</p></td>
    </tr>
    <tr>
      <th>nrow, ncol</th>
      <td><p>Number of rows and columns defined for "monthly" calendar
layout. If <code>NULL</code>, it computes a sensible layout.</p></td>
    </tr>
    <tr>
      <th>polar</th>
      <td><p>FALSE (the default) for Cartesian or TRUE for polar coordinates.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>"fixed" (the default) for fixed scale. "free" for scaling
conditional on each daily cell, "free_wday" for scaling on weekdays,
"free_mday" for scaling on day of month.</p></td>
    </tr>
    <tr>
      <th>width, height</th>
      <td><p>Numerics between 0 and 1 to specify the width/height for
each glyph.</p></td>
    </tr>
    <tr>
      <th>margin</th>
      <td><p>Numerics of length two between 0 and 1 to specify the horizontal
and vertical margins between month panels.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Extra arguments passed to <code>geom_label()</code> and <code>geom_text()</code></p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>A "ggplot" object or "plotly".</p></td>
    </tr>
    <tr>
      <th>label</th>
      <td><p>If "label" is specified, it will add month/week text on the
<code>ggplot</code> object, which is actually passed to <code>geom_label()</code>. If "text" is
specified, it will add weekday/day of month text on the <code>ggplot</code> object,
which is actually passed to <code>geom_text()</code>. By default, both "label" and
"text" are used. If "text2" is specified for the "monthly" calendar only,
it will add day of month to the <code>ggplot</code> object.</p></td>
    </tr>
    <tr>
      <th>locale</th>
      <td><p>ISO 639 language code. The default is "en" (i.e. US English).
For other languages support, package <strong>readr</strong> needs to be installed.
See <a href='https://readr.tidyverse.org/reference/locale.html'>readr::locale</a> for more details.</p></td>
    </tr>
    <tr>
      <th>abbr</th>
      <td><p>Logical to specify if the abbreviated version of label should be
used.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame or a dplyr::tibble with newly added columns of <code>.x</code>, <code>.y</code>. <code>.x</code>
and <code>.y</code> together give new coordinates computed for different types of
calendars. <code>date</code> groups the same dates in a chronological order, which is
useful for <code>geom_line</code> or <code>geom_path</code>. The basic use is <code>ggplot(aes(x = .x, y = .y, group = date)) + geom_*</code>. The variable names <code>.x</code> and <code>.y</code> reflect
the actual <code>x</code> and <code>y</code> with a prefix <code>.</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The calendar-based graphic can be considered as small multiples
of sub-series arranged into many daily cells. For every multiple (or
facet), it requires the <code>x</code> variable mapped to be time of day and <code>y</code> to
value. New <code>x</code> and <code>y</code> are computed and named with a <code>.</code> prefixed to variable
according to <code>x</code> and <code>y</code> respectively, and get ready for <code>ggplot2</code> aesthetic
mappings. In conjunction with <code><a href='https://rdrr.io/pkg/plotly/man/reexports.html'>group_by()</a></code>, it allows the grouped variable
to have their individual scales. For more details, see <code><a href='../articles/frame-calendar.html'>vignette("frame-calendar", package = "sugrrants")</a></code></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='facet-calendar.html'>facet_calendar</a> for a fully-fledged faceting calendar with formal
labels and axes.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>, <span class='kw'>warn.conflicts</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># compute the calendar layout for the data frame</span>
<span class='no'>calendar_df</span> <span class='kw'>&lt;-</span> <span class='no'>hourly_peds</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>Sensor_ID</span> <span class='kw'>==</span> <span class='fl'>13</span>, <span class='no'>Year</span> <span class='kw'>==</span> <span class='fl'>2016</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>frame_calendar</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>Time</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>Hourly_Counts</span>, <span class='kw'>date</span> <span class='kw'>=</span> <span class='no'>Date</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>4</span>)

<span class='co'># ggplot</span>
<span class='no'>p1</span> <span class='kw'>&lt;-</span> <span class='no'>calendar_df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>ggplot</span>(<span class='fu'>aes</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>.Time</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>.Hourly_Counts</span>, <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>Date</span>)) +
  <span class='fu'>geom_line</span>()
<span class='fu'>prettify</span>(<span class='no'>p1</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>label.padding</span> <span class='kw'>=</span> <span class='fu'>unit</span>(<span class='fl'>0.15</span>, <span class='st'>"lines"</span>))</div><div class='img'><img src='frame-calendar-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># use in conjunction with group_by()</span>
<span class='no'>grped_calendar</span> <span class='kw'>&lt;-</span> <span class='no'>hourly_peds</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>Year</span> <span class='kw'>==</span> <span class='st'>"2017"</span>, <span class='no'>Month</span> <span class='kw'>==</span> <span class='st'>"March"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span>(<span class='no'>Sensor_Name</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>frame_calendar</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>Time</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>Hourly_Counts</span>, <span class='kw'>date</span> <span class='kw'>=</span> <span class='no'>Date</span>, <span class='kw'>week_start</span> <span class='kw'>=</span> <span class='fl'>7</span>)

<span class='no'>p2</span> <span class='kw'>&lt;-</span> <span class='no'>grped_calendar</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>ggplot</span>(<span class='fu'>aes</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>.Time</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>.Hourly_Counts</span>, <span class='kw'>group</span> <span class='kw'>=</span> <span class='no'>Date</span>)) +
  <span class='fu'>geom_line</span>() +
  <span class='fu'>facet_wrap</span>(~ <span class='no'>Sensor_Name</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>2</span>)
<span class='fu'>prettify</span>(<span class='no'>p2</span>)</div><div class='img'><img src='frame-calendar-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># allow for different languages</span>
<span class='co'># below gives simplied Chinese labels with STKaiti font family,</span>
<span class='co'># assuming this font installed in user's local system</span>
<span class='fu'>prettify</span>(<span class='no'>p2</span>, <span class='kw'>locale</span> <span class='kw'>=</span> <span class='st'>"zh"</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"STKaiti"</span>)

<span class='co'># plotly example</span>
<span class='kw'>if</span> (!<span class='fu'><a href='https://rdrr.io/r/base/ns-load.html'>requireNamespace</a></span>(<span class='st'>"plotly"</span>, <span class='kw'>quietly</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)) {
  <span class='fu'><a href='https://rdrr.io/r/base/stop.html'>stop</a></span>(<span class='st'>"Please install the 'plotly' package to run these following examples."</span>)
}
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>plotly</span>)
<span class='no'>pp</span> <span class='kw'>&lt;-</span> <span class='no'>calendar_df</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/plotly/man/reexports.html'>group_by</a></span>(<span class='no'>Date</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/plotly/man/plot_ly.html'>plot_ly</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> ~ <span class='no'>.Time</span>, <span class='kw'>y</span> <span class='kw'>=</span> ~ <span class='no'>.Hourly_Counts</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/plotly/man/add_trace.html'>add_lines</a></span>(<span class='kw'>text</span> <span class='kw'>=</span> ~ <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"Count: "</span>, <span class='no'>Hourly_Counts</span>, <span class='st'>"&lt;br&gt; Time: "</span>, <span class='no'>Time</span>))
<span class='fu'>prettify</span>(<span class='no'>pp</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://earo.me'>Earo Wang</a>, <a href='http://dicook.org'>Di Cook</a>, <a href='http://robjhyndman.com'>Rob Hyndman</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


